<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Admin ‚Äì Utilisateurs | TrendyShop</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-100 min-h-screen">
    <%- include("../partials/header") %>

    <div class="container mx-auto px-4 py-10">
      <!-- TITRE -->
      <h1 class="text-3xl font-bold mb-6">üë• Gestion des utilisateurs</h1>

      <p class="mb-8 text-gray-700">
        Total utilisateurs : <strong><%= users.length %></strong>
      </p>

      <!-- TABLE -->
      <div class="bg-white rounded shadow overflow-x-auto">
        <% if (users.length === 0) { %>
        <p class="p-6 text-gray-500">Aucun utilisateur trouv√©.</p>
        <% } else { %>
        <table class="w-full border-collapse">
          <thead>
            <tr class="bg-gray-200 text-left">
              <th class="p-3">ID</th>
              <th class="p-3">Nom</th>
              <th class="p-3">Email</th>
              <th class="p-3">R√¥le</th>
              <th class="p-3">Inscrit le</th>
              <th class="p-3 text-center">Actions</th>
            </tr>
          </thead>

          <tbody>
            <% users.forEach(u => { %>
            <tr class="border-t hover:bg-gray-50">
              <td class="p-3 text-sm text-gray-600"><%= u.id %></td>

              <td class="p-3 font-medium"><%= u.name %></td>

              <td class="p-3 text-sm"><%= u.email %></td>

              <td class="p-3">
                <% if (u.isAdmin) { %>
                <span
                  class="bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-semibold"
                >
                  ADMIN
                </span>
                <% } else { %>
                <span
                  class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-semibold"
                >
                  CLIENT
                </span>
                <% } %>
              </td>

              <td class="p-3 text-sm text-gray-600">
                <%= new Date(u.createdAt).toLocaleDateString("fr-FR") %>
              </td>

              <td class="p-3 text-center">
                <% if (user.id !== u.id) { %>
                <form
                  action="/admin/users/<%= u.id %>/toggle-admin"
                  method="POST"
                  class="inline"
                  onsubmit="return confirm('Modifier le r√¥le de cet utilisateur ?')"
                >
                  <button
                    class="px-3 py-1 rounded text-sm font-semibold <%= u.isAdmin ? 'bg-yellow-500 hover:bg-yellow-600 text-white' : 'bg-indigo-600 hover:bg-indigo-700 text-white' %>"
                  >
                    <%= u.isAdmin ? "Retirer admin" : "Rendre admin" %>
                  </button>
                </form>
                <% } else { %>
                <span class="text-gray-400 text-sm italic"> Vous </span>
                <% } %>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
        <% } %>
      </div>

      <!-- NAVIGATION -->
      <div class="mt-8">
        <a
          href="/admin"
          class="inline-block bg-gray-800 hover:bg-gray-900 text-white px-6 py-2 rounded"
        >
          ‚Üê Retour au dashboard admin
        </a>
      </div>
    </div>
  </body>
  <%- include("../partials/footer") %>
</html>
